(()=>{var e={860:e=>{"use strict";e.exports=require("express")},439:e=>{"use strict";e.exports=require("http")},952:e=>{"use strict";e.exports=require("socket.io")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}(()=>{const e=o(860),t=e(),{Server:n,Socket:s}=o(952),i=o(439).createServer(t),r=new n(i,{cors:{methods:["GET","POST","PUT","PATCH","DELETE","OPTIONS"],allowedHeaders:["X-Total-Count","X-Authorization"],origin:"*",credentials:!0,exposedHeaders:"*",optionsSuccessStatus:200}});o(439).createServer();t.use(e.static("public")),t.set("view engine","ejs"),t.set("views","./views");let c=[],_=!1;r.on("connection",(function(e){if(console.log("Co nguoi vua ket noi id =",e.id),e.on("client_login",(function(t){console.log("client_login =",e.id),"gamifa@"===t?(_=!0,e.emit("login_status",{success:!0})):e.emit("login_status",{success:!1})})),console.log("adminLogin---\x3e",_),!_)return r.emit("event_from_web_to_app",{type:"disconnect"}),c=[],void r.emit("server_send_list_user",c);e.on("client_logout",(function(){_=!1,r.emit("event_from_web_to_app",{type:"disconnect"}),c=[],r.emit("server_send_list_user",c)})),e.emit("event_from_app_to_web","connected to server"),_&&e.emit("admin_had_login"),r.emit("server_send_list_user",c),e.on("disconnect",(function(e){console.log("Co nguoi vua mat ket noi id =",e)})),e.on("event_from_web_disconnect_user",(function({socket_id:e}){console.log("disconnect user",e),r.to(e).emit("event_from_web_to_app",{type:"disconnect"}),c=c.filter((t=>t.socket_id!=e)),r.emit("server_send_list_user",c)})),e.on("user_connect",(function(t){console.log("user_connect",t),c.find((t=>t.socket_id==e.id))||c.push({socket_id:e.id}),r.emit("server_send_list_user",c)})),e.on("event_from_app",(function(e){r.emit("event_from_app_to_web",e)})),e.on("event_from_web_disconnect",(function(e){console.log("event_from_web_disconnect"),r.emit("event_from_web_to_app",{type:"disconnect"}),c=[],r.emit("server_send_list_user",c)}))})),t.get("/",(function(e,t){console.log("render home"),t.render("index")})),i.listen(3007),console.log("NodeJS Server running at port 3007")})()})();